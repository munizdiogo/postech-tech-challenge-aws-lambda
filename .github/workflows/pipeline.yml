name: Pipeline

on:
    push:
        branches: ["main"]
    workflow_dispatch:

jobs:
    deploy:
        # The type of runner that the job will run on
        runs-on: ubuntu-latest

        # Steps represent a sequence of tasks that will be executed as part of the job
        steps:
            - name: Checkout
              uses: actions/checkout@v3

            - name: Configurar aws cli
              run: |
                  sudo apt install -y awscli
                  aws configure set aws_access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }}
                  aws configure set aws_secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }}
                  aws configure set default_region_name ${{ secrets.AWS_DEFAULT_REGION_NAME }}
                  aws configure set default_output_format JSON

            - name: Fazer deploy
              run: |
                  cd functions/criarUsuario
                  zip criarUsuario.zip lambda_function.py
                  aws lambda update-function-code --function-name lambdaSignupCognito --zip-file fileb://./criarUsuario.zip --region ${{ secrets.AWS_DEFAULT_REGION_NAME }}
                  cd ../login
                  zip login.zip lambda_function.py
                  aws lambda update-function-code --function-name lambdaFazerLoginCognito --zip-file fileb://./login.zip --region ${{ secrets.AWS_DEFAULT_REGION_NAME }}
    # test:
    #     # The type of runner that the job will run on
    #     runs-on: ubuntu-latest

    #     # Steps represent a sequence of tasks that will be executed as part of the job
    #     steps:
    #         - name: Checkout
    #           uses: actions/checkout@v3

    #         - name: Configurar aws cli
    #           run: |
    #               sudo apt install -y awscli
    #               aws configure set aws_access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }}
    #               aws configure set aws_secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    #               aws configure set default_region_name ${{ secrets.AWS_DEFAULT_REGION_NAME }}
    #               aws configure set default_output_format JSON
    #               aws configure set cli-binary-format raw-in-base64-out

    #         - name: Fazer deploy
    #           run: |
    #               echo '{
    #                     "operation": "echo",
    #                     "payload": {
    #                         "somekey1": "somevalue1",
    #                         "somekey2": "somevalue2"
    #                     }
    #                 }'
    #                 aws lambda invoke --function-name LambdaFunctionOverHttps \
    #                 --payload file://input.txt outputfile.txt --cli-binary-format raw-in-base64-out
